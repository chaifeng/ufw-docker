.\" ufw-docker.8 - fix the Docker and UFW security flaw without disabling iptables
.\" install in /usr/local/man/man8/ufw-docker.8
.TH UFW-DOCKER 8 2025-07-24

.SH NAME
ufw-docker \- fix the Docker and UFW security flaw without disabling iptables

.SH SYNOPSIS
.B ufw-docker
help|status
.br
.B ufw-docker
install|check [--docker-subnets [\fIsubnet\fR ...]] [--help]
.br
.B ufw-docker
allow|deny|list
\fIcontainer\fR [\fIport\fR[/tcp|/udp]] [\fInetwork\fR]
.br
.B ufw-docker
[service] allow|deny
\fIcontainer\fR [\fIport\fR[/tcp|/udp]] [\fInetwork\fR]
.br
.B ufw-docker
[service] delete allow|deny
\fIcontainer\fR [\fIport\fR[/tcp|/udp]] [\fInetwork\fR]

.SH DESCRIPTION
Docker manages iptables directly, bypassing UFW and exposing published ports regardless of UFW rules. ufw-docker inserts a set of iptables rules into UFWâ€™s after.rules (via DOCKER-USER chain) so that UFW can govern which published ports are reachable from public networks.

.SH COMMANDS
.TP
.B install \fR[--docker-subnets [\fIsubnet\fR ...]] [--help]
Inserts the special rules block into /etc/ufw/after.rules and restarts UFW.

Use --docker-subnets to customize which subnets will be allowed to communicate with Docker containers. If the option is \fBnot provided\fR, only standard private LAN subnets will be used (IPv4: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16; IPv6: fd00::/8). If no subnets are provided all Docker network subnets will be detected and used automatically.
This option applies to both IPv4 and IPv6 networks.

Using --help shows more explanatory text and exits.

.TP
.B check \fR[--docker-subnets [\fIsubnet\fR ...]] [--help]
Same as \fBinstall\fR, but shows the changes instead of appling them.

.TP
.B help
Shows help.

.TP
.B list \fIcontainer\fR [\fIport\fR[\fB/tcp\fR|\fB/udp\fR]] [\fInetwork\fR]
Lists all firewall rules related to a specific container. Can be filtered to only show a specific port with a specific protocol for a specific network.

.TP
.B status
Shows the current firewall allowed forward rules.

.TP
.B allow\fR|\fBdeny \fIcontainer\fR [\fIport\fR[\fB/tcp\fR|\fB/udp\fR]] [\fInetwork\fR]
Adds a UFW rule allowing/denying traffic to the specified container. Can be further limited to a port, protocol or network.

(Can be prepended with \fBservice\fR to target services instead of containers.)

.TP
.B delete allow\fR|\fBdeny \fIcontainer\fR [\fIport\fR[\fB/tcp\fR|\fB/udp\fR]] [\fInetwork\fR]
Removes \fBALL\fR rules that allow/deny traffic to a container. Can be further limited to only remove rules with a specific port, protocol or network.

(Can be prepended with \fBservice\fR to target services instead of containers.)

.SH EXIT STATUS
.TP
0
Successful program execution.
.TP
1
Unsuccessful program execution.

.SH EXAMPLES

.TP
.B ufw-docker install
.TP
.PP
Use default private LAN subnets (IPv4: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, IPv6: fd00::/8).

.TP
.B ufw-docker install --docker-subnets
.TP
.PP
Auto-detect and use all Docker network subnets (both IPv4 and IPv6).

.TP
.B ufw-docker list httpd
.TP
.PP
List all firewall rules related to container \fIhttpd\fR.

.TP
.B ufw-docker allow httpd 443/tcp foobar-external-network
.TP
.PP
Expose the \fI443\fR port of the container \fIhttpd\fR and the protocol is \fItcp\fR and the network is \fIfoobar-external-network\fR when the container \fIhttpd\fR is attached to multiple networks.

.TP
.B ufw-docker delete allow httpd 443/tcp
.TP
.PP
Remove the rule which port is \fI443\fR and protocol is \fItcp\fR for the container \fIhttpd\fR.

.TP
.B
.TP
.PP


.SH FILES
.TP
.B /etc/ufw/after.rules
Modified by install/uninstall.

.SH NOTES
.B INSTALL

.nf
# download the script
sudo wget -O /usr/local/bin/ufw-docker \\
	https://github.com/chaifeng/ufw-docker/raw/master/ufw-docker
sudo chmod +x /usr/local/bin/ufw-docker

# integrate with UFW (adds iptables rules)
sudo ufw-docker install
.fi

.B UNINSTALL

Open file \fI/etc/ufw/after.rules\fR, remove all lines between
.B # BEGIN UFW AND DOCKER
and
.B # END UFW AND DOCKER
.

.PP
If you want to remove all things related to ufw-docker:

.TP
.B 1.
Remove the script \fBufw-docker\fR (and this man page).

.TP
.B 2.
Run the following command to find the docker image downloaded by ufw-docker.

.nf
\fBdocker images | grep ufw-docker-agent\fR
.fi

.TP
.B 3.
Then use the following command to remove the corresponding Docker image.

.nf
\fBdocker rmi\fR \fIimage\fR
.fi

.SH AUTHOR
Script by Chai Feng and contributors. Source:
.UR
https://github.com/chaifeng/ufw-docker
.UE

(Man page by Elia Nitsche.)

.SH SEE ALSO
.BR ufw (8),
.BR docker (1),
.BR iptables (8)
